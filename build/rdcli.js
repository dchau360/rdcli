#!/usr/bin/env node
'use strict';var _realDebrid=require('./real-debrid');var _realDebrid2=_interopRequireDefault(_realDebrid);var _package=require('../package.json');var _package2=_interopRequireDefault(_package);var _commander=require('commander');var _commander2=_interopRequireDefault(_commander);var _coPrompt=require('co-prompt');var _coPrompt2=_interopRequireDefault(_coPrompt);var _singleLineLog=require('single-line-log');var _singleLineLog2=_interopRequireDefault(_singleLineLog);var _co=require('co');var _co2=_interopRequireDefault(_co);var _fs=require('fs');var _fs2=_interopRequireDefault(_fs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}_commander2.default.version(_package2.default.version).description('Download torrent and ddl').usage('<url|magnet|torrent>').action(function(arg){return (0,_co2.default)(regeneratorRuntime.mark(function action(){var unrestrictLink,api,connect,link;return regeneratorRuntime.wrap(function action$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:unrestrictLink=void 0;api=new _realDebrid2.default();connect=regeneratorRuntime.mark(function connect(){var username,password;return regeneratorRuntime.wrap(function connect$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return (0,_coPrompt2.default)('Username: ');case 2:username=_context.sent;_context.next=5;return _coPrompt2.default.password('Password: ');case 5:password=_context.sent;_context.next=8;return api.connect(username,password);case 8:case 'end':return _context.stop();}}},connect,this);});if(!arg.match(/^(https?:\/\/)([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w\? \.-]*)*\/?$/)){_context2.next=11;break;}_context2.next=6;return connect();case 6:_context2.next=8;return api.unrestrictLink(arg);case 8:unrestrictLink=_context2.sent;_context2.next=24;break;case 11:if(!(arg.match(/magnet:\?xt=urn:[a-z0-9]+:[a-z0-9]{20,50}/i)||_fs2.default.existsSync(arg))){_context2.next=22;break;}_context2.next=14;return connect();case 14:_context2.next=16;return api.convertToDdl(arg);case 16:link=_context2.sent;_context2.next=19;return api.unrestrictLink(link);case 19:unrestrictLink=_context2.sent;_context2.next=24;break;case 22:console.log('Usage: rdcli <url|magnet|torrent>');process.exit();case 24:_context2.next=26;return api.download(unrestrictLink,function(res){if(!isNaN(res.percent)){_singleLineLog2.default.stdout('Download: '+res.percent+'% Speed: '+res.mbps+'Mbps '+res.bytesWriting+'/'+res.totalSize);}else if(res==='end'){console.log('File downloaded.');}else {console.log('Error: '+res);}});case 26:case 'end':return _context2.stop();}}},action,this);}));}).parse(process.argv);if(!process.argv.slice(2).length){_commander2.default.outputHelp();}