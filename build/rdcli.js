#!/usr/bin/env node
'use strict';require('babel-polyfill');var _commander=require('commander');var _commander2=_interopRequireDefault(_commander);var _coPrompt=require('co-prompt');var _coPrompt2=_interopRequireDefault(_coPrompt);var _ora=require('ora');var _ora2=_interopRequireDefault(_ora);var _co=require('co');var _co2=_interopRequireDefault(_co);var _chalk=require('chalk');var _chalk2=_interopRequireDefault(_chalk);var _fs=require('fs');var _fs2=_interopRequireDefault(_fs);var _download=require('./download');var _torrent=require('./torrent');var _unrestrict=require('./unrestrict');var _unrestrict2=_interopRequireDefault(_unrestrict);var _connect=require('./connect');var _connect2=_interopRequireDefault(_connect);var _package=require('../package.json');var _package2=_interopRequireDefault(_package);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}_commander2.default.version(_package2.default.version).description('Download links, magnets and torrent files.').usage('<url|magnet|torrent>').action(function(arg){return(0,_co2.default)(regeneratorRuntime.mark(function action(){var _this=this;return regeneratorRuntime.wrap(function action$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;return _context2.delegateYield(regeneratorRuntime.mark(function _callee(){var username,password,token,link,unrestrictLink,spinner;return regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return(0,_coPrompt2.default)('Username: ');case 2:username=_context.sent;_context.next=5;return _coPrompt2.default.password('Password: ');case 5:password=_context.sent;_context.next=8;return(0,_connect2.default)(username,password);case 8:token=_context.sent;link=void 0;if(!arg.match(/^(https?:\/\/)([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w\? \.-]*)*\/?$/)){_context.next=14;break;}link=arg;_context.next=22;break;case 14:if(!(arg.match(/^magnet:\?xt=urn:[a-z0-9]+:[a-z0-9]{20,50}/i)||_fs2.default.existsSync(arg))){_context.next=20;break;}_context.next=17;return(0,_torrent.convertTorrent)(arg,token);case 17:link=_context.sent;_context.next=22;break;case 20:console.log('Usage: rdcli <url|magnet|torrent>');process.exit();case 22:_context.next=24;return(0,_unrestrict2.default)(link,token);case 24:unrestrictLink=_context.sent;console.log('Start download : '+unrestrictLink);_context.next=28;return(0,_download.waitDuringScan)(link);case 28:spinner=(0,_ora2.default)('Download: 0.0% Speed: 0Mbps').start();(0,_download.download)(unrestrictLink,function(res){if(res.percent){spinner.text='Download: '+res.percent+'% Speed: '+res.mbps+' '+res.bytesWriting+'/'+res.totalSize+' Remaining: '+res.remaining+'sec';// eslint-disable-line max-len
}else if(res==='end'){spinner.stop();console.log('File downloaded.');}else{spinner.stop();console.log('Error: '+res);}});case 30:case'end':return _context.stop();}}},_callee,_this);})(),'t0',2);case 2:_context2.next=8;break;case 4:_context2.prev=4;_context2.t1=_context2['catch'](0);console.error('\n'+_chalk2.default.red(_context2.t1));process.exit();case 8:case'end':return _context2.stop();}}},action,this,[[0,4]]);}));}).parse(process.argv);if(!process.argv.slice(2).length){_commander2.default.outputHelp();}